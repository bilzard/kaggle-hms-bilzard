# 多クラス分類モデルを等価な2値分類モデルに変換する方法

## 概要

多クラス分類モデルのlogit出力$z_0, ..., z_5$ に対して適当な変換を施すことで、多クラスの確率予測値$\{p_0, ..., p_5\}$ を二値分類モデル $\{p_0, 1 - p_0\}$ の予測値に変換する問題を考える。

問題の要請は以下:
1. クラス0の予測値が同じになること。
1. クラス0以外のクラスに対しては*なんら意味のある推測を行わないこと*。すなわち、荷重和によるensembleにおいて、*クラス0以外のクラスの確率分布に影響を与えないこと*。

上記の要請は、logit空間の予測値に適当な変換（変換1）を加え、変換後のクラス0の確率$p_0$ が元の多クラス分類の確率と一致するように$\bar{z}$ をうまく選ぶことで満たされる。

変換1: $\{z_0, ..., z_5\} \rightarrow \{z_0 - \bar{z}, 0, ..., 0\}$

## 問題

上記の問題は、変換1の前後でクラス0の確率が同じになるようなバイアス$\bar{z}$ を求める問題に帰着される。

## 解法

多クラス分類モデルにおけるクラス0の確率は、

$$p_0 = \frac{e^{z_0}}{\sum_i{e^{z_i}}} \tag{1}$$

により求まる。一方で、logitの予測値に変換1を施した場合に計算されるクラス0の確率は、

$$p_0^\prime = \frac{e^{z_0}}{e^{z_0} + 5e^{\bar{z}}} \tag{2}$$

と計算できる。要請1より、$p_0 = p_0^\prime$だから、式(1-2)を$\bar{z}$ に対して解くと、

$$\bar{z} = \log \sum_{i \neq 0}e^{z_i} - \log 5 \tag{3}$$

を得る。従って、変換後のlogitの値$z_0^\prime$は、

$$z_0^\prime = z_0 - \log \sum_{i \neq 0}e^{z_i} + \log 5 \tag{4}$$

となる。